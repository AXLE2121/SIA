name: Netlify CI/CD Pipeline

on:
  push:
    branches:
      - main   # change to master if needed

jobs:
  pipeline:
    runs-on: ubuntu-latest

    steps:

      # ============================
      # ðŸŸ¦ STEP 1 â€” CHECKOUT CODE
      # ============================
      - name: ðŸŸ¦ Step 1: Checkout Repository
        uses: actions/checkout@v4


      # ============================
      # ðŸŸ© STEP 2 â€” SETUP NODE
      # ============================
      - name: ðŸŸ© Step 2: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18


      # ============================
      # ðŸŸ¨ STEP 3 â€” INSTALL DEPENDENCIES
      # ============================
      - name: ðŸŸ¨ Step 3: Install Dependencies
        run: npm install


      # ============================
      # ðŸŸ§ STEP 4 â€” RUN TESTS
      # ============================
      - name: ðŸŸ§ Step 4: Run Tests
        run: npm test
        continue-on-error: true   # remove this if you want to block deployment on test fail


      # ============================
      # ðŸŸª STEP 5 â€” BUILD PROJECT
      # ============================
      - name: ðŸŸª Step 5: Build Project
        run: npm run build


      # ============================
      # ðŸŸ¥ STEP 6 â€” DEPLOY TO NETLIFY
      # ============================
      - name: ðŸŸ¥ Step 6: Deploy to Netlify
        uses: nwtgck/actions-netlify@v3.0
        with:
          publish-dir: 'SIA'      # change if your final build folder is different
          production-branch: main
          github-token: ${{ secrets.GITHUB_TOKEN }}
          deploy-message: "CI/CD Pipeline: Test â†’ Build â†’ Deploy"
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
